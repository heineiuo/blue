!function(a){function b(a,b){for(var c=0;c<a.length;c++)a[c]==b&&(a.splice(c,1),c--);return a}function c(a){var b=require("url"),c=a.method.toLowerCase(),d=b.parse(a.url).pathname,e=d.substr(1).split("/"),f=b.parse(a.url).search,g=null!=f?querystring.parse(f.substring(1)):{},h=a.headers["x-forwarded-for"]||a.connection.remoteAddress||a.socket.remoteAddress||a.connection.socket.remoteAddress,i={};return a.headers.cookie&&a.headers.cookie.split(";").forEach(function(a){var b=a.split("=");i[b[0].trim()]=(b[1]||"").trim()}),{method:c,pathname:d,pathname_arr:e,search:f,searches:g,ip:h,cookies:i}}function d(a){var b=require("crypto").createHash("md5");return b.update(a),b.digest("hex")}function e(a){var b=require("crypto").createHash("sha1");return b.update(a),b.digest("hex")}function f(a,b,c){var a=querystring.stringify(a),b=b;b.method="POST";var d=!1,e=http.request(b,function(a){a.setEncoding("utf8"),a.on("data",function(a){a=JSON.parse(a),c(d,a)})});e.on("error",function(a){console.log("problem with request: "+a.message),d=!0,c(d)}),e.write(a),e.end()}function g(a,b){var d=c(a).method;if("post"==d){var e=new formidable.IncomingForm,f={searches:{},files:[]};e.uploadDir=temp_dir,e.on("progress",function(){}).on("field",function(a,b){f.searches[a]=b}).on("file",function(a,b){f.files.push(a,b)}).on("aborted",function(){f.error="UNEXCEPT_ERROR"}).on("error",function(){f.error="UNEXCEPT_ERROR"}).on("end",function(){b(f)}),e.parse(a)}else b({error:"ONLY_POST"})}function h(a,b){var c={nickname:{regex:/^[\u4e00-\u9fa5_a-zA-Z0-9]{8,16}$/},nicename:{regex:/^[a-zA-Z]{1}[a-zA-Z0-9_]{5,15}$/},password:{regex:/^[0-9A-Za-z_-]{8,20}$/},email:{regex:/^email$/},phone:{regex:/^[0-9]{11}$/},gender:{regex:/^[0-9]{1}$/},region:{regex:/^[0-9]{3}$/},address:{regex:/^[\.]{0,280}$/},date:{regex:/^[1-9]{1}[0-9]{9}$/}};return"undefined"==typeof c[a].regex?c[a].validator(b):c[a].regex.test(b)}function i(a){var b=require("url"),c=a.method.toLowerCase(),d=b.parse(a.url).pathname,e=d.substr(1).split("/"),f=b.parse(a.url).search,g=null!=f?querystring.parse(f.substring(1)):{},h=a.headers["x-forwarded-for"]||a.connection.remoteAddress||a.socket.remoteAddress||a.connection.socket.remoteAddress,i={};return a.headers.cookie&&a.headers.cookie.split(";").forEach(function(a){var b=a.split("=");i[b[0].trim()]=(b[1]||"").trim()}),a.method=c,a.pathname=d,a.pathname_arr=e,a.search=f,a.searches=g,a.ip=h,a.cookies=i,a}function j(a){return a.http_status_code=200,a.contentType="json",a.send=function(b){{var b=b||{},c=this.contentType;this.http_status_code}"json"==c&&"object"==typeof b?(b=JSON.stringify(b),typed="application/json"):(b=String(b),typed="text/plain"),a.writeHead(200,{"Content-Type":[typed,";charset=UTF-8"].join(""),"Access-Control-Allow-Origin":"*"}),a.write(b),a.end()},a.sendError=function(a){this.send({error:a})},a}function k(){function a(){var a={};return a}return a}function l(){function a(a){var c=require("http"),d=(require("url"),require("mysql"),require("util"),require("fs"),require("querystring"),require("formidable"),[]),a={apis_errors:{},uri_prefix:a.uri_prefix||"",error:a.error||{},cache_dir:a.cache_dir||__dirname+"/../blue_cache",temp_dir:a.temp_dir||__dirname+"/../blue_cache/temp"},e={listen:function(b){var e=c.createServer(function(b,c){function e(b){for(var c=!1,e=0;e<d.length;e++)if(d[e].uri.test(b.substr(a.uri_prefix.length))){c=d[e];break}return c}function f(){}var b=i(b),c=j(c);if("/"+b.pathname_arr[0]!=a.uri_prefix)c.sendError("NOT_FOUND");else{var g=e(b.pathname);g&&g.method==b.method?g.callback(b,c,f):c.sendError("NOT_FOUND")}});e.listen(b),console.log("SUCCESS: 启动成功, 端口: "+b)},use:function(a,c,e){function f(a){return new RegExp("^\\/"+a.join("\\/")+"$")}function g(){d.push({method:a,uri:c,callback:e})}if("string"==typeof c){var h=b(c.split("/"),"");c=f(h),g()}else if(c instanceof Array)c=f(c),g();else{if(!(c instanceof RegExp))return!1;g()}},get_config:function(){return a},parse:g};return e}return{get_req_param:c,createServer:a,md5:d,sha1:e,http_post:f,validator:h}}"function"==typeof define&&define.amd?define([""],k):"object"==typeof exports?module.exports=l():a.blue=k()}(this);